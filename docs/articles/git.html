<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>googleCloudRunner and git (GitHub, GitLab, BitBucket etc.) • googleCloudRunner</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/readable/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="googleCloudRunner and git (GitHub, GitLab, BitBucket etc.)">
<meta property="og:description" content="googleCloudRunner">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]--><!-- Global site tag (gtag.js) - Google Analytics --><script async src="https://www.googletagmanager.com/gtag/js?id=UA-47480439-2"></script><script>
  window.dataLayer = window.dataLayer || [];
  function gtag(){dataLayer.push(arguments);}
  gtag('js', new Date());

  gtag('config', 'UA-47480439-2');
</script>
</head>
<body data-spy="scroll" data-target="#toc">
    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">googleCloudRunner</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.2.0.9000</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fa fa-home"></span>
     
  </a>
</li>
<li>
  <a href="../articles/setup.html">
    <span class="fa fa-wrench"></span>
     
    Setup
  </a>
</li>
<li>
  <a href="../articles/cloudbuild.html">
    <span class="fa fa-shapes"></span>
     
    Cloud Build
  </a>
</li>
<li>
  <a href="../articles/cloudrun.html">
    <span class="fa fa-running"></span>
     
    Cloud Run
  </a>
</li>
<li>
  <a href="../articles/cloudscheduler.html">
    <span class="fa fa-clock"></span>
     
    Cloud Scheduler
  </a>
</li>
<li>
  <a href="../articles/usecases.html">
    <span class="fa fa-hands-helping"></span>
     
    Use Cases
  </a>
</li>
<li>
  <a href="../reference/index.html">
    <span class="fa fa-question"></span>
     
    Functions
  </a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/MarkEdmondson1234/googleCloudRunner/">
    <span class="fab fa fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>googleCloudRunner and git (GitHub, GitLab, BitBucket etc.)</h1>
            
            <h4 class="date">2020-06-05</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/MarkEdmondson1234/googleCloudRunner/blob/master/vignettes/git.Rmd"><code>vignettes/git.Rmd</code></a></small>
      <div class="hidden name"><code>git.Rmd</code></div>

    </div>

    
    
<p>A lot of the features of Cloud Build rely on connection with git workflows.</p>
<p>Connecting Cloud Build and git allows you to create workflows that automate tasks upon each git commit.</p>
<p>A rundown on some common workflows and connections are detailed here.</p>
<div id="cloud-build-triggers-and-github-app" class="section level2">
<h2 class="hasAnchor">
<a href="#cloud-build-triggers-and-github-app" class="anchor"></a>Cloud Build Triggers and GitHub App</h2>
<p>Cloud Builds can be triggered via Build Triggers, and those Build Triggers can be initiated by GitHub, Bitbucket or Cloud Repository events such as commits or pull requests.</p>
<p>A common use case is triggering R package tests upon each commit.</p>
</div>
<div id="authorization-for-cloud-build-to-commit-to-git" class="section level2">
<h2 class="hasAnchor">
<a href="#authorization-for-cloud-build-to-commit-to-git" class="anchor"></a>Authorization for Cloud Build to commit to git</h2>
<p>This is useful if you want your Cloud Build to modify or commit to a git repo.</p>
<p>Common use cases are to build a website via <code>pkgdown</code> and then commit that website version back to GitHub to auto-build R documentation websites.</p>
<p>It also allows you to work with other git repos perhaps not connected to Cloud Build via Build Triggers.</p>
<p>To do so, Cloud Build needs permission to commit to git, so the first step is to create an ssh key secret that it will use to work on your behalf. This is recommended to be done via <code>cr_buildstep_secret</code> as you can then reuse the secret across multiple builds, since the ssh key is kept securely within your Google Project.</p>
<p>The guide is for GitHub, adapt it if you use another git provider:</p>
<ol style="list-style-type: decimal">
<li>Create or use an SSH key for your git account. On GitHub use this guide: <code>https://help.github.com/en/github/authenticating-to-github/connecting-to-github-with-ssh</code>
</li>
<li>Add the <strong>public</strong> key (filename ending with <code>.pub</code>) to GitHub’s SSH keys</li>
<li>Upload the <strong>private</strong> key (filename not ending with <code>.pub</code>) to Google Secret Manager - <code>https://console.cloud.google.com/security/secret-manager</code> and call it a name such as <code>github-ssh</code>
</li>
<li>Ensure you have <code>Secret Manager Secret Accessor</code> <a href="https://console.cloud.google.com/iam-admin/iam">IAM role</a> assigned to the cloudbuild service email (<code>{project-number}@cloudbuild.gserviceaccount.com</code>)</li>
<li>Use in your buildsteps by calling and using the git secret via:</li>
</ol>
<div class="sourceCode" id="cb1"><html><body><pre class="r"><span class="co"># assumes you have previously saved git ssh key called "github-ssh"</span>
<span class="fu"><a href="../reference/cr_build_yaml.html">cr_build_yaml</a></span>(
      <span class="kw">steps</span> <span class="kw">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(
           <span class="fu"><a href="../reference/cr_buildstep_git.html">cr_buildstep_gitsetup</a></span>(<span class="st">"github-ssh"</span>),
           <span class="fu"><a href="../reference/cr_buildstep_git.html">cr_buildstep_git</a></span>(<span class="fu"><a href="https://rdrr.io/r/base/c.html">c</a></span>(<span class="st">"clone"</span>,
                              <span class="st">"git@github.com:github_name/repo_name"</span>))
      )
  )</pre></body></html></div>
</div>
<div id="duplicating-git-repos-to-cloud-source-repositories" class="section level2">
<h2 class="hasAnchor">
<a href="#duplicating-git-repos-to-cloud-source-repositories" class="anchor"></a>Duplicating git repos to Cloud Source repositories</h2>
<p>You can also use Google Cloud Platform’s git repostory system directly, name Cloud Source Repositories. Even if you don’t use them day to day, you can set them up as duplicate of your preferred Git service, which then enables you to use workflows that only work from Cloud Source Repositories.</p>
<p>This enables you to create Builds that rely on Source objects under git control, an alternative to Cloud Storage buckets.</p>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p>Developed by Mark Edmondson.</p>
</div>

<div class="pkgdown">
  <p>Site built with <a href="https://pkgdown.r-lib.org/">pkgdown</a> 1.5.1.</p>
</div>

      </footer>
</div>

  


  </body>
</html>
